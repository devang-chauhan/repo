<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0 shrink-to-fit=no">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <title>HOK Script Repository</title>
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <script src="bootstrap/js/jquery.slim.min.js"></script>
  <script src="bootstrap/js/tether.min.js"></script>
  <script src="bootstrap/js/bootstrap.min.js"></script>
  <script src="bootstrap/js/scripts.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


  <script type="text/javascript">
    $(document).ready(function() {
      $.ajax({
        type: 'GET',
        url: 'data.json',
        dataType: 'json',
        success: jsonParser
      });
    });

    function jsonParser(json) {
      $('#load').fadeOut();

      $.getJSON('data.json', function(data) {
        var main = data;
        $.each(data.repo, function(k, v) {
          var filename = v.file;
          var thumbnail = v.thumbnail;
          var tags = v.tags;
          var class_id = v.class;

          // Load all the thumbnails
          $('#grid').append('<img class="card-images card-img-top img-fluid" src="data/' + filename + '/' + thumbnail + '.png" id="' + filename + '" alt="' + tags + '"/>');
        });


        // Wrap all the images in anchor tag and supply Query Strings
        $(function() {
          $('#grid .card-images').each(function() { // For each image
            var a = $(this).attr('id');
            $(this).wrap('<a href="viewer.html?owner=' + a + '"></a>');
          });
        });


        // Wrap all anchor tags in section tag
        $(function() {
          $('#grid a').each(function() { // For each anchor tag
            var key = $(this).attr('href');
            var strippedkey = key.split("=");
            $(this).wrap('<section class="card mb-5" id="' + strippedkey[1] + '"></section>')
          });
        });


        // Add a div tage inside each section tag
        $(function() {
          $('#grid section').each(function() { // For each section tag
            var key = $(this).attr('id');
            $(this).append('<div class="card-body" id="' + key + '"></div>')
          });
        });


        // add file name and tags to the div container
        $(function() {
          $('#grid .card-body').each(function() { // div tag defined above
            key = $(this).attr("id");
            cardName = key.replace("_", " ");
            $(this).append('<h5 class="card-title mb-0 mt-0 text-capitalize">' + cardName + '</h5>');
            var tagsToAdd = main.repo[key].tags;
            $(this).append('<h7 class="card-subtitle mt-0 text-secondary">' + tagsToAdd + '</h7>');
          });
        });

        // Wrap all section tags in a div tag
        $(function() {
          $('#grid section').each(function() { // For each section tag
            let id_to_add = $(this).attr("id");
            $(this).wrap('<div class="col" id="' + id_to_add + '"></div>')
          });
        });





        // Getting a list of cards to show based on search
        var cards = main.repo;

        // Formatting all tags
        function format_array(array) {
          let formatted_tags = [];
          for (i = 0; i < array.length; i++) {
            let formatted_tag = (array[i].toLowerCase()).trim();
            formatted_tags.push(formatted_tag);
          }
          return formatted_tags;
        }


        // Filtering Card names based on search query
        function filter_cards(keyword) {
          let keyword_toCheck = keyword.toLowerCase();
          let keys = [];
          for (key in cards) {
            let tags = cards[key].tags;
            let tags_list = tags.split("#").slice(1, );
            let formatted_tag_list = format_array(tags_list);
            let tag_check = formatted_tag_list.includes(keyword_toCheck);
            if (tag_check == true) {
              keys.push(key);
            }
          }
          return keys;
        }

        // List of card to display
        var filetered_cards = filter_cards("Ladybug");

        // Showing cards based on Search query
        $(function() {
          $('div .col').each(function() {
            key = $(this).attr("id"); //Get id value
            let visibility_check = filetered_cards.includes(key);
            console.log(visibility_check);
            if (visibility_check == false) {
              $(this).css({
                "display": "none"
              });
            } else {}
          });
        });


      });

    }




    // Filer results
    // $(document).ready(function() {
    //   $("#filtering").on("keyup", function() {
    //     var value = $(this).val().toLowerCase();
    //     $("#myTable tr").filter(function() {
    //       $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    //     });
    //   });
    // });
  </script>

</head>

<body>
  <!-- Navigation bar -->
  <nav class="navbar navbar-light navbar-expand-sm" style="background-color:white;">
    <div class="container">
      <img src="images/HOK_logo_RGB_jpg_lg.jpg" style="width:40px;" alt="HOK Logo">
      <!-- <h2 class="navbar-brand m-0" style="color:rgb(249, 35, 47);" href="#">Script Repository</h2> -->

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#myTogglerNav" aria-controls="myTogglerNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="myTogglerNav">
        <div class="navbar-nav ml-auto">
          <a class="nav-item nav-link" href="about.html">About</a>
          <a class="nav-item nav-link" href="features.html">Planned Features</a>
          <a class="nav-item nav-link disabled" href="#">Script Requests</a>
          <a class="nav-item nav-link disabled" href="#">How to Contribute</a>
        </div>
      </div>
    </div>
  </nav>


  <div class="container">

    <h6 title="Click on images to see the details and download the files...">
      Welcome to HOKware! <span></span>
      <span style="float:right">
        <input type="text" id="filtering" placeholder="Search by keyword or Project" title="Filter the results by tag name or project name" size="25">
      </span>
    </h6>
    <!-- Grid of Cards -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 rounded-lg" id="grid">

      <!-- Loader-->
      <!-- <div class="mx-auto d-block text-center">
        <img src="images/loading.gif" id="load" width="100" height="100" />
      </div> -->


    </div>
  </div>
  </div>
</body>

</html>